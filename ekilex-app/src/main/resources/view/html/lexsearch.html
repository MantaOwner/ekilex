<!DOCTYPE html>
<html lang="et" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="common :: common_header(~{::title},~{::links})">
<title th:text="#{lex.search.title}">EKILEX otsing</title>
<th:block th:fragment="links">
  <script type="text/javascript" th:src="@{/view/js/ekilex-editor.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-searchfilter.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-lexsearch.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-lexdialog.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-dialog.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-sourcesearch.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/ekilex-autocomplete.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/bootstrap-datepicker.js}"></script>
  <script type="text/javascript" th:src="@{/view/js/bootstrap-datepicker.et.min.js}"></script>
</th:block>
</head>
<body class="body-with-navbar compacted d-flex flex-column">
  <th:block th:replace="common :: nav_bar(activeItem = 'lex')"></th:block>
  <div class="card shadow rounded-0 border-0">
    <div class="card-body px-2 py-3">
      <form id="searchForm" th:action="@{/lexsearch}" method="post">
        <th:block th:replace="search :: search_form('lex_search', true)"></th:block>
      </form>
    </div>
  </div>
  <div class="container-fluid flex-grow-1 flex-shrink-1 d-flex flex-column h-100 overflow-auto">
    <div class="mt-4 float-left" th:if="${noResults}">
      <div th:text="#{lex.not.found}">Not found.</div>
    </div>
    <div class="mt-4 float-left" th:if="${invalidSearch}">
      <div th:text="#{lex.search.invalid}"></div>
    </div>
    <div class="row no-gutters py-3 flex-grow-1 h-100" th:unless="${noResults}">
      <div class="col-3 pr-2 h-100">
        <div id="results_div" class="card shadow navigate-panel h-100 d-flex flex-column" th:if="${not #lists.isEmpty(wordsResult.words)}">
          <div th:replace="lexcomp :: search_result"></div>
        </div>
      </div>
      <div class="col-9 h-100 d-flex flex-column">
        <div id="word-details-area"></div>
      </div>
    </div>
  </div>
  <th:block th:fragment="word_details" th:if="${details != null}">
    <div th:data-id="${wordId}" id="word-details-area" class="h-100"
         th:with="
           isWordCrudGranted=${#authorization.expression('hasPermission(#vars.wordId, ''WORD'', ''DATASET:CRUD'')')},
           isWordReadGranted=${#authorization.expression('hasPermission(#vars.wordId, ''WORD'', ''DATASET:READ'')')}">
      <button id="refresh-details" hidden th:data-id="${wordId}" name="word-details-btn" data-refresh></button>
      <div class="navigate-panel card shadow h-100">
        <div class="card-body p-0 d-flex flex-column h-100">
          <div class="border-bottom px-2  py-2">
            <div class="d-flex flex-row align-items-center">
              <div class="hover-actions-container hover-actions-container-outline">
                <h1 th:id="${'word-value-' + wordId}" th:utext="${viewUtil.getWordValueMarkup(details.word)}" class="mb-0">Aktiivne sõna</h1>
                <div class="hover-actions hover-actions-bottom-right">
                  <button type="button" class="btn btn-compact btn-secondary"
                          title="Muuda"
                          data-toggle="modal"
                          th:data-target="${'#editWordValueDlg_' + wordId}"
                          sec:authorize="${#vars.isWordCrudGranted}">
                    <i class="fa fa-pencil action-icon" aria-hidden="true"></i>
                  </button>
                </div>
                <span class="lbl">Viimati muudetud: </span>
                <span th:text="${#dates.format(details.lastChangedOn, 'dd.MM.yyyy')}"></span>
              </div>
              <div class="ml-2">
                <form th:action="@{/wordjoin}" method="get">
                  <input type="hidden" name="wordId" th:value="${details.word.wordId}">
                  <button type="submit" class="btn btn-secondary btn-compact"
                          title="Ühenda keelendid"
                          sec:authorize="${#vars.isWordCrudGranted}">Ühenda
                  </button>
                </form>
              </div>
              <div sec:authorize="${#vars.isWordReadGranted}" class="ml-auto d-flex align-items-center flex-row">
                <span class="text-secondary mr-1"> Logid </span>
                <div class="btn-group ">
                  <a th:href="@{'/wordprocesslog:' + ${wordId}}" data-toggle="modal"
                     data-target="#processLogDlg"
                     class="btn btn-secondary btn-compact position-relative pr-1">
                    <span class="d-block" data-toggle="tooltip" title="Vaata kommentaare">
                      Kommentaarid
                      <span class="badge badge-counter" th:text="${details.wordProcessLogCount}"
                            th:classappend="${details.wordProcessLogCount > 0} ? 'badge-danger' : 'badge-secondary'">0</span>
                    </span>
                  </a>
                  <button type="button" class="btn btn-secondary btn-compact px-0"
                          data-toggle="modal"
                          th:data-target="${'#addWordProcessLogDlg_' + wordId}"
                          sec:authorize="${#vars.isWordCrudGranted}">
                    <i class="action-icon fa fa-plus px-2 d-block" aria-hidden="true" title="Lisa kommentaar" data-toggle="tooltip"></i>
                  </button>
                </div>
                <div id="processLogDlg" class="modal" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                      </div>
                      <div class="modal-body" style="max-height: 90vh; overflow-y: auto;"></div>
                    </div>
                  </div>
                </div>
                <a th:href="@{'/wordlifecyclelog:' + ${wordId}}" data-toggle="modal"
                   data-target="#wordLifecycleLogDlg"
                   class="btn btn-secondary btn-compact ml-2">Tegevused</a>
                <div id="wordLifecycleLogDlg" class="modal" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                      </div>
                      <div class="modal-body" style="max-height: 90vh; overflow-y: auto;"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex flex-row">
              <div th:replace="lexcomp :: word_lang"></div>
              <div th:replace="lexcomp :: word_vocal_form"></div>
              <div th:replace="lexcomp :: word_gender"></div>
              <div th:replace="lexcomp :: word_type"></div>
              <div th:replace="lexcomp :: word_aspect"></div>
            </div>
          </div>
          <div class="row no-gutters h-100 overflow-hidden">
            <div class="col-8 overflow-auto h-100 pt-3">
              <th:block th:each="lexeme : ${details.lexemes}">
                <div th:id="${'lexeme-details-' + lexeme.lexemeId}">
                  <th:block th:replace="lexdetail :: lexeme_details_lite"></th:block>
                </div>
              </th:block>
            </div>
            <div class="col-4 border-left border-light h-100 overflow-auto">
              <div th:replace="lexdialog :: add_word_relation_dlg"></div>
              <div th:replace="lexdialog :: add_od_word_recommendation_dlg"></div>
              <div th:replace="lexdialog :: add_word_lang_dlg"></div>
              <div th:replace="lexdialog :: add_word_gender_dlg"></div>
              <div th:replace="lexdialog :: add_word_type_dlg"></div>
              <div th:replace="lexdialog :: add_word_aspect_dlg"></div>
              <div th:replace="lexdialog :: add_word_vocal_form_dlg"></div>
              <div th:replace="lexdialog :: add_word_process_log_dlg"></div>
              <div th:replace="lexdialog :: edit_word_value_dlg"></div>
              <div th:replace="lexdialog :: edit_word_lang_dlg"></div>
              <div th:replace="lexdialog :: edit_word_gender_dlg"></div>
              <div th:replace="lexdialog :: edit_word_aspect_dlg"></div>
              <div th:replace="lexdialog :: edit_word_vocal_form_dlg"></div>
              <div class="pt-3 mb-2">
                <div class="card-body pt-0 pb-0">
                  <span class="lbl">ÕS soovitab</span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa ÕS soovitab" data-toggle="modal"
                          th:data-target="${'#addOdWordRecommendationDlg_' + wordId}"
                          sec:authorize="${#vars.isWordCrudGranted}">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                  </button>
                  <div th:each="odWordRecommendation, itemIter : ${details.odWordRecommendations}">
                    <div th:replace="lexdialog :: edit_od_word_recommendation"></div>
                    <div class="col hidden-buttons pr-5">
                      <div class="action-buttons-anchor">
                        <span th:utext="${odWordRecommendation.valuePrese}"></span>
                        <div class="action-buttons-2">
                          <button type="button" class="btn badge badge-primary"
                                  title="Muuda"
                                  data-toggle="modal"
                                  th:data-target="${'#editOdWordRecommendationDlg_' + odWordRecommendation.id}"
                                  sec:authorize="${#vars.isWordCrudGranted}">
                            <i class="fa fa-edit" aria-hidden="true"></i>
                          </button>
                          <button type="button" class="btn badge badge-warning"
                                  th:data-id="${odWordRecommendation.id}"
                                  data-op-code="od_word_recommendation"
                                  data-toggle="delete-confirm"
                                  data-placement="right"
                                  sec:authorize="${#vars.isWordCrudGranted}">
                            <i class="fa fa-remove" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr/>
                </div>
                <div class="pb-3" th:if="${not #lists.isEmpty(details.paradigms)}">
                  <div th:each="paradigm,paradigmIter : ${details.paradigms}" th:if="${paradigm.formsExist}" class="pt-2 mb-2">
                    <button class="btn btn-info ml-3" type="button" data-toggle="collapse" th:data-target="${'#paradigmArea_' + paradigm.paradigmId}">
                      <span th:text="${paradigmIter.count + '.'}" th:if="${paradigmIter.size > 1}"></span>
                      <span>vormid</span>
                    </button>
                    <div th:id="${'paradigmArea_' + paradigm.paradigmId}" class="collapse p-1">
                      <div th:if="${not #lists.isEmpty(paradigm.forms)}">
                        <table>
                          <tr th:each="form : ${paradigm.forms}">
                            <td style="width: 200px" class="text-right pr-1">
                              <span th:text="${form.morphCode + ' - ' + form.morphValue}" th:if="${form.displayMorphCode}" style="font-size: 80%; color: #999"></span>
                            </td>
                            <td class="pr-1">
                              <span th:text="${form.value}" th:title="${form.formFrequencies}"></span>
                            </td>
                            <td class="pr-1">
                              <span th:text="${form.displayForm}" th:unless="${#strings.isEmpty(form.displayForm)}" style="font-size: 80%; color: #999"></span>
                            </td>
                            <td>
                              <span th:text="${form.vocalForm}" th:unless="${#strings.isEmpty(form.vocalForm)}" style="font-size: 80%; color: #999"></span>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </div>
                  <hr/>
                </div>
                <div class="card-body pt-0 pb-0">
                  <span class="lbl">Keelendi seosed</span>
                  <button type="button" class="btn badge badge-success"
                          title="Lisa seos" data-toggle="modal"
                          th:data-target="${'#addWordRelationDlg_' + wordId}"
                          sec:authorize="${#vars.isWordCrudGranted}">
                    <i class="fa fa-plus" aria-hidden="true"></i>
                  </button>
                  <table class="orderable" data-op-code="word_relation" th:if="${not #lists.isEmpty(details.wordRelations)}">
                    <tr th:each="relation, itemIter : ${details.wordRelations}" th:data-id="${relation.id}" th:data-orderby="${relation.orderBy}">
                      <td class="action-column">
                        <th:block th:replace="common :: ordering_buttons(${itemIter})" sec:authorize="${#vars.isWordCrudGranted}"></th:block>
                      </td>
                      <td class="invisible-buttons">
                        <button type="button" class="btn btn-link btn-text-wrap btn-xs" th:data-id="${relation.wordId}" name="word-details-btn">
                          <span th:utext="${viewUtil.getWordValueMarkup(relation) + ' (' + viewUtil.getLangIso2(relation.wordLang) + ')'}"></span>
                        </button>
                        <button type="button" class="btn badge badge-warning"
                                th:data-id="${relation.id}"
                                data-op-code="word_relation"
                                data-toggle="delete-confirm"
                                data-placement="left"
                                sec:authorize="${#vars.isWordCrudGranted}">
                          <i class="fa fa-remove" aria-hidden="true"></i>
                        </button>
                      </td>
                      <td>
                        <span th:text="${relation.relTypeLabel}"></span>
                      </td>
                    </tr>
                  </table>
                  <table th:if="${not #lists.isEmpty(details.wordGroups)}">
                    <tr th:each="wordGroup : ${details.wordGroups}">
                      <td class="invisible-buttons">
                        <span th:each="relation, itemIter : ${wordGroup.members}">
                          <button type="button" class="btn btn-link btn-xs" th:data-id="${relation.wordId}" name="word-details-btn">
                            <span th:utext="${viewUtil.getWordValueMarkup(relation)}"></span>
                          </button>
                          <button type="button" class="btn badge badge-warning"
                                  th:data-id="${relation.id}"
                                  data-op-code="word_relation"
                                  data-toggle="delete-confirm"
                                  data-placement="left"
                                  sec:authorize="${#vars.isWordCrudGranted}">
                            <i class="fa fa-remove" aria-hidden="true"></i>
                          </button>
                          <span th:unless="${itemIter.last}"></span>
                        </span>
                      </td>
                      <td>
                        <span th:text="${wordGroup.groupTypeLabel}"></span>
                      </td>
                    </tr>
                  </table>
                  <hr/>
                </div>
                <div class="card-body pt-0 pb-0" th:if="${not #lists.isEmpty(details.wordEtymology)}">
                  <span class="lbl">Keelendi etümoloogia</span>
                  <th:block th:each="wordEtym, itemIter : ${details.wordEtymology}">
                    <div>
                      <div>
                        <span th:if="${wordEtym.questionable}">?</span>
                        <span th:if="${wordEtym.etymologyTypeCode != null}" th:text="${wordEtym.etymologyTypeCode}"></span>
                        <span th:if="${wordEtym.etymologyYear != null}" th:text="${wordEtym.etymologyYear}"></span>
                      </div>
                      <div th:each="wordEtymSourceLink : ${wordEtym.wordEtymSourceLinks}">
                        <span th:text="${wordEtymSourceLink.value}"></span>
                      </div>
                      <div th:each="wordEtymRel : ${wordEtym.wordEtymRelations}">
                        <button type="button" class="btn btn-link btn-xs" th:data-id="${wordEtymRel.relatedWordId}" name="word-details-btn">
                          <span>
                            <span th:if="${wordEtymRel.questionable}">?</span>
                            <span th:if="${wordEtymRel.compound}">+</span>
                            <span th:text="${wordEtymRel.relatedWord + ' (' + viewUtil.getLangIso2(wordEtymRel.relatedWordLang) + ')'}"></span>
                          </span>
                        </button>
                        <span th:if="${wordEtymRel.comment != null}" th:utext="${wordEtymRel.comment}"></span>
                      </div>
                      <div th:if="${wordEtym.comment != null}" th:utext="${wordEtym.comment}"></div>
                    </div>
                    <div th:unless="${itemIter.last}">
                      <hr/>
                    </div>
                  </th:block>
                  <hr/>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script th:replace="common :: confirmations"></script>
    </div>
  </th:block>
  <div th:replace="common :: #sourceDetailsDlg"></div>
  <div th:replace="common :: #alertDlg"></div>
  <div th:replace="common :: #confirmDlg"></div>
  <div th:replace="common :: #waitDlg"></div>
  <div th:replace="lexdialog :: new_word_dlg"></div>
  <div th:replace="sourcedialog :: add_source_dlg('lex_search')"></div>
  <script th:inline="javascript">
	  initialise();
  </script>
</body>
</html>
